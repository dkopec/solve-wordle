@page
@model IndexModel
@{
    ViewData["Title"] = "Wordle Solver";
}

<div class="container mt-4">
    <h1 class="mb-4">Wordle Solver</h1>
    <p class="lead">Enter your Wordle clues to find possible words!</p>

    @if (Model.BestStartingWords != null && Model.BestStartingWords.Any() && Model.PossibleWords == null)
    {
        <div class="alert alert-info mb-4">
            <h6 class="alert-heading mb-2"><i class="bi bi-lightbulb"></i> Best Starting Words:</h6>
            <div class="d-flex flex-wrap gap-2">
                @foreach (var word in Model.BestStartingWords)
                {
                    <span class="badge bg-primary fs-6 cursor-pointer starting-word" data-word="@word.ToUpper()" 
                          style="cursor: pointer;" title="Click to use this word">@word.ToUpper()</span>
                }
            </div>
            <small class="text-muted d-block mt-2">These words are statistically most likely to help you solve the puzzle based on past Wordle answers.</small>
        </div>

        @if (!string.IsNullOrEmpty(Model.GuessInOne))
        {
            <div class="alert alert-success mb-4 border-3 border-success">
                <h5 class="alert-heading mb-3">
                    <i class="bi bi-trophy-fill text-warning"></i> <strong>Feeling Lucky? Guess in One!</strong>
                </h5>
                <div class="text-center py-3">
                    <div class="mb-3">
                        <span class="badge bg-success text-white fs-1 px-5 py-3 shadow-lg" id="guessInOneWord" style="font-family: monospace; letter-spacing: 8px; cursor: pointer;" 
                              onclick="navigator.clipboard.writeText(this.textContent.trim()); const orig = this.innerHTML; this.innerHTML = '<i class=\\'bi bi-check-circle-fill\\'></i> COPIED!'; setTimeout(() => this.innerHTML = orig, 2000);" 
                              title="Click to copy">
                            @Model.GuessInOne.ToUpper()
                        </span>
                    </div>
                    <div class="mb-3">
                        <button type="button" class="btn btn-outline-success" id="refreshGuessInOne">
                            <i class="bi bi-arrow-clockwise"></i> Try Another Word
                        </button>
                    </div>
                    <small class="text-muted">
                        <i class="bi bi-info-circle"></i> This is today's top statistical pick from past Wordle answers. 
                        Click the word to copy, or try another suggestion!
                    </small>
                </div>
            </div>
        }
    }

    <form method="post" class="mb-4" id="wordleForm">
        <div class="mb-3">
            <label class="form-label">Correct Letters (Green)</label>
            <div class="d-flex gap-2 mb-2" id="letterBoxes">
                <input type="text" class="form-control text-center letter-box" maxlength="1" 
                       name="letter1" id="letter1" value="@(Model.CorrectPositions?.Length > 0 && Model.CorrectPositions[0] != '_' ? Model.CorrectPositions[0].ToString() : "")" 
                       style="width: 60px; height: 60px; font-size: 24px; font-weight: bold; text-transform: uppercase;">
                <input type="text" class="form-control text-center letter-box" maxlength="1" 
                       name="letter2" id="letter2" value="@(Model.CorrectPositions?.Length > 1 && Model.CorrectPositions[1] != '_' ? Model.CorrectPositions[1].ToString() : "")" 
                       style="width: 60px; height: 60px; font-size: 24px; font-weight: bold; text-transform: uppercase;">
                <input type="text" class="form-control text-center letter-box" maxlength="1" 
                       name="letter3" id="letter3" value="@(Model.CorrectPositions?.Length > 2 && Model.CorrectPositions[2] != '_' ? Model.CorrectPositions[2].ToString() : "")" 
                       style="width: 60px; height: 60px; font-size: 24px; font-weight: bold; text-transform: uppercase;">
                <input type="text" class="form-control text-center letter-box" maxlength="1" 
                       name="letter4" id="letter4" value="@(Model.CorrectPositions?.Length > 3 && Model.CorrectPositions[3] != '_' ? Model.CorrectPositions[3].ToString() : "")" 
                       style="width: 60px; height: 60px; font-size: 24px; font-weight: bold; text-transform: uppercase;">
                <input type="text" class="form-control text-center letter-box" maxlength="1" 
                       name="letter5" id="letter5" value="@(Model.CorrectPositions?.Length > 4 && Model.CorrectPositions[4] != '_' ? Model.CorrectPositions[4].ToString() : "")" 
                       style="width: 60px; height: 60px; font-size: 24px; font-weight: bold; text-transform: uppercase;">
            </div>
            <input type="hidden" name="correctPositions" id="correctPositions" value="@Model.CorrectPositions">
            <small class="form-text text-muted">Enter known letters in their correct positions. Leave blank for unknown positions.</small>
        </div>

        <div class="mb-3">
            <label class="form-label">Wrong Position Letters (Yellow)</label>
            <div id="wrongPositionRows">
                <!-- Rows will be added dynamically -->
            </div>
            <button type="button" class="btn btn-sm btn-outline-secondary mt-2" id="addWrongPosRow">
                + Add Row
            </button>
            <input type="hidden" name="wrongPositions" id="wrongPositions" value="@Model.WrongPositions">
            <small class="form-text text-muted d-block mt-2">For each yellow letter, enter it in the position(s) where it appeared but was wrong. Multiple rows let you track different guesses.</small>
        </div>

        <div class="mb-3">
            <label class="form-label">Excluded Letters (Gray)</label>
            <div id="excludedLetterBoxes">
                <!-- Rows will be added dynamically -->
            </div>
            <button type="button" class="btn btn-sm btn-outline-secondary mt-2" id="addExcludedLetter" style="display: none;">
                + Add Row
            </button>
            <input type="hidden" name="excludedLetters" id="excludedLetters" value="@Model.ExcludedLetters">
            <small class="form-text text-muted d-block mt-2">Enter letters that are not in the word at all. New rows will appear automatically as you type.</small>
        </div>

        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="excludePastAnswers" name="excludePastAnswers" 
                   checked="@Model.ExcludePastAnswers" value="true">
            <label class="form-check-label" for="excludePastAnswers">
                Exclude previous Wordle answers
            </label>
            <small class="form-text text-muted d-block">
                Note: While Wordle rarely reuses past answers, it can happen. Uncheck this if you're not finding expected words.
            </small>
        </div>

        <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-search"></i> Find Words
            </button>
            <button type="button" class="btn btn-outline-secondary" id="resetButton">
                <i class="bi bi-arrow-counterclockwise"></i> Reset
            </button>
        </div>
    </form>

    @if (Model.PossibleWords != null && Model.PossibleWords.Any())
    {
        <div class="alert alert-success d-flex justify-content-between align-items-center">
            <div>
                <h4 class="mb-1">
                    <i class="bi bi-check-circle-fill"></i> 
                    Found @Model.PossibleWords.Count possible word@(Model.PossibleWords.Count != 1 ? "s" : "")
                </h4>
                <small class="text-muted">Ranked by statistical likelihood - Top suggestion is most probable</small>
            </div>
            @if (Model.PossibleWords.Count <= 5)
            {
                <span class="badge bg-success fs-5 px-4 py-2">
                    <i class="bi bi-bullseye"></i> CLOSE!
                </span>
            }
            else if (Model.PossibleWords.Count <= 20)
            {
                <span class="badge bg-warning fs-5 px-4 py-2">
                    <i class="bi bi-funnel"></i> NARROWING
                </span>
            }
        </div>
        
        @if (Model.StrategicWords != null && Model.StrategicWords.Any())
        {
            <div class="alert alert-warning mb-3">
                <h5 class="alert-heading mb-3">
                    <i class="bi bi-lightbulb-fill"></i> Strategic Play Option
                </h5>
                @if (Model.PossibleWords!.Count > 10)
                {
                    <p class="mb-2">
                        <strong>With @Model.PossibleWords.Count possibilities remaining, a "throwaway word" is recommended</strong> to eliminate more options faster.
                        These words won't be the answer, but they'll give you maximum information:
                    </p>
                }
                else if (Model.PossibleWords.Count > 3)
                {
                    <p class="mb-2">
                        <strong>@Model.PossibleWords.Count possibilities remain.</strong> You can try the top-ranked word, or use a strategic word to narrow further:
                    </p>
                }
                else
                {
                    <p class="mb-2">
                        <strong>Only @Model.PossibleWords.Count option@(Model.PossibleWords.Count != 1 ? "s" : "") left!</strong> Try the top word, or use strategic play to confirm:
                    </p>
                }
                <div class="d-flex flex-wrap gap-2 mt-3">
                    @foreach (var strategic in Model.StrategicWords)
                    {
                        <span class="badge bg-warning text-dark fs-6 px-3 py-2" style="cursor: pointer;" 
                              title="Try this word to eliminate the most possibilities">
                            <i class="bi bi-gear-fill"></i> @strategic.Word.ToUpper()
                        </span>
                    }
                </div>
                <small class="text-muted d-block mt-2">
                    <i class="bi bi-info-circle"></i> <strong>Smart strategy:</strong> These words avoid your green letters and test the most uncertain variables.
                    @if (Model.PossibleWords.Count > 5)
                    {
                        <text>After trying one, you'll dramatically narrow down the possibilities!</text>
                    }
                    else
                    {
                        <text>Use these to confidently confirm the answer or eliminate remaining options.</text>
                    }
                </small>
            </div>
        }
        
        @if (Model.PossibleWords.Count <= 3 && Model.PossibleWords.First().ConfidencePercentage >= 75)
        {
            <div class="alert alert-info mb-3">
                <strong><i class="bi bi-stars"></i> Strong recommendation:</strong> 
                Try "<strong class="text-uppercase fs-5">@Model.PossibleWords.First().Word</strong>" 
                (@Model.PossibleWords.First().ConfidencePercentage.ToString("F1")% confidence)
            </div>
        }
        else if (Model.PossibleWords.Count > 3 && Model.PossibleWords.Count <= 5)
        {
            <div class="alert alert-success mb-3">
                <i class="bi bi-target"></i> <strong>You're close!</strong> Try the top-ranked word below, or if unsure, use a strategic word above to narrow further.
            </div>
        }
        
        <div class="list-group mb-3">
            @foreach (var suggestion in Model.PossibleWords.Take(50))
            {
                var confidenceClass = suggestion.ConfidencePercentage >= 70 ? "success" : 
                                     suggestion.ConfidencePercentage >= 50 ? "info" :
                                     suggestion.ConfidencePercentage >= 30 ? "warning" : "secondary";
                var progressWidth = Math.Round(suggestion.ConfidencePercentage, 0);
                var isTopPick = suggestion.Rank == 1;
                var borderClass = isTopPick && suggestion.ConfidencePercentage >= 70 ? "border-success border-3" : "";
                var bgClass = isTopPick && suggestion.ConfidencePercentage >= 70 ? "top-pick-highlight" : "";
                
                <div class="list-group-item d-flex justify-content-between align-items-center mb-2 @borderClass @bgClass">
                    <div class="d-flex align-items-center" style="min-width: 220px;">
                        <span class="badge @(isTopPick ? "bg-success" : "bg-dark") me-3" style="font-size: 0.9rem; min-width: 35px;">
                            @if (isTopPick)
                            {
                                <i class="bi bi-star-fill"></i>
                            }
                            else
                            {
                                @("#" + suggestion.Rank)
                            }
                        </span>
                        <strong class="fs-5 text-uppercase" style="font-family: monospace; letter-spacing: 2px; @(isTopPick ? "font-weight: bold; font-size: 1.5rem !important;" : "")">
                            @suggestion.Word
                        </strong>
                        @if (isTopPick && suggestion.ConfidencePercentage >= 75)
                        {
                            <span class="ms-2 text-success"><i class="bi bi-arrow-left-circle-fill"></i> BEST</span>
                        }
                    </div>
                    <div class="d-flex align-items-center flex-grow-1 ms-4">
                        <div class="progress flex-grow-1 me-3" style="height: 25px; max-width: 300px;">
                            <div class="progress-bar bg-@confidenceClass @(isTopPick ? "progress-bar-striped progress-bar-animated" : "")" role="progressbar" 
                                 style="width: @(progressWidth)%" 
                                 aria-valuenow="@progressWidth" aria-valuemin="0" aria-valuemax="100">
                                <strong>@suggestion.ConfidencePercentage.ToString("F1")%</strong>
                            </div>
                        </div>
                        <span class="badge bg-@confidenceClass" style="min-width: 70px; font-size: 0.95rem;">@suggestion.ConfidencePercentage.ToString("F1")%</span>
                    </div>
                </div>
            }
        </div>
        @if (Model.PossibleWords.Count > 50)
        {
            <div class="alert alert-info">
                <i class="bi bi-info-circle"></i> Showing top 50 of <strong>@Model.PossibleWords.Count</strong> words. 
                Add more clues to narrow down the results. Focus on the top-ranked suggestions.
            </div>
        }
    }
    else if (Model.PossibleWords != null)
    {
        <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle"></i> No matching words found. Try adjusting your clues.
        </div>
    }
</div>
